{% extends 'layout.html' %}

{% load staticfiles %}

{% block content %}

<br><br><br>
<div class="container">
	{% block search %}
		<form class="form-horizontal" action="{% url 'main.views.views.search_results' %}" method="post">
		    <div>
		    {% csrf_token %}
		    {{ form }}
			<button class="btn btn-default" type="submit">
				<i class="fa fa-search fa-fw"></i>
				<span class="network-name">Search</span>
			</button>
		    </div>
		</form>
	{% endblock %}
	<div class='col-sm-4'>
    <br>
    <br>
    <br>
    <h3>Recent Posts</h3>
    <div id='posts'></div>
</div>
</div>

{% endblock %}

{% block javascript %}
<!--Begin javascript to grab the django api posts-->
<script type='text/javascript'>
    var focus;
    var interval;

    function getPosts(){
        if (focus) {
            interval = setInterval(function(){ loadData() }, 3000);
        } else {
            clearInterval(interval);
        }
    }

    function loadData(){
        $.getJSON("{% url 'api_post_list' user.pk %}", 
            function(data) {
                var items = [];
                $.each(data, function(key, val){
                    items.push("<li><h4><a href='/user/" + val.owner.id + "'>" + val.owner.username + "</a></h4> said '" + val.title + "'</li>");
                });
                var posts = $('<ul/>', { "class": "", html: items.join('') });
                $('#posts').html(posts);
        });
    }

    $(document).ready(function(){
        loadData();
        $(window).focus(function(){
            focus = true;
            getPosts();
        })
        .blur(function(){
            focus = false;
            getPosts();
        })
    })

</script>
{% endblock %}